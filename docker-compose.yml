version: '3.8'

name: impactra

services:
  n8n:
    image: n8nio/n8n:latest
    container_name: n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_PORT=5678
      - N8N_HOST=0.0.0.0
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=admin
      - N8N_BASIC_AUTH_PASSWORD=123456
      - N8N_EDITOR_BASE_URL=http://localhost:5678/
      - N8N_LOG_LEVEL=info      
    volumes:
      - data:/home/node/.n8n
    restart: unless-stopped

  business-analyst:
    build: ./BusinessAnalyst
    image: business-analyst:latest
    container_name: business-analyst
    ports:
      - "5000:5000"
    environment:
      - CEREBRAS_API_KEY=${CEREBRAS_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    volumes:
      - data:/data
    restart: unless-stopped
    depends_on:
      - n8n
  
  programmer:
    build: ./Programmer
    image: programmer:latest
    container_name: programmer
    ports:
      - "5001:5001"
    environment:
      - CEREBRAS_API_KEY=${CEREBRAS_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    volumes:
      - data:/data
    restart: unless-stopped
    depends_on:
      - n8n

  code-runner:
    build:
      context: .
      dockerfile: CodeRunner/Dockerfile
    image: code-runner:latest
    container_name: code-runner
    ports:
      - "5002:5002"
    environment:
      - CEREBRAS_API_KEY=${CEREBRAS_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    volumes:
      - data:/data
    restart: unless-stopped
    depends_on:
      - n8n

volumes:  
  data:
    driver: local