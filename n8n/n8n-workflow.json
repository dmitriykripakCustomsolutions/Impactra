{
  "name": "Slack to Local Service Extended",
  "nodes": [
    {
      "parameters": {
        "jsCode": "if ($input.first().json.body[\"type\"] === \"url_verification\") {\n  return {\n        challenge: $input.first().json.body.challenge\n      };  \n} else {\n  return {\n      json: $input.first().json\n    };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1280,
        -256
      ],
      "id": "8c1e580d-c123-473c-ba6c-bd59d5d0dcc9",
      "name": "Respond to Slack Verification"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "http://host.docker.internal:5001/process-task",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={{ { \"taskId\": $('Business Analyst: Raw Technical Task Send').item.json.taskId } }}"
      },
      "name": "Programmer: Technical Task Send",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        -336,
        112
      ],
      "id": "9d005365-b9d2-44e5-8c94-68b2e1728ef2",
      "continueOnFail": true
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "http://host.docker.internal:5002/run-code",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={{ { taskId: $json.taskId } }}"
      },
      "name": "Code Runner: Source Code Send",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        -128,
        112
      ],
      "id": "92cfbe99-0b39-4a48-a1c5-127966cd55ce",
      "continueOnFail": true
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "http://host.docker.internal:5001/receive-test-results",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={{ { allTestsPassed: $json.allTestsPassed, taskId: $('Programmer: Technical Task Send').item.json.taskId } }}"
      },
      "name": "Programmer: Code Runner Result Send",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        320,
        112
      ],
      "id": "b26e4364-835c-422f-8ca8-3699a538b43d",
      "disabled": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "http://host.docker.internal:5000/receive-task-completion-result",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={{ { \"taskId\": $('Business Analyst: Raw Technical Task Send').item.json.taskId } }}"
      },
      "name": "Business Analyst: Task Completion Result Send",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        480,
        96
      ],
      "id": "9c13df01-ad9d-45de-a679-0e222d8b1c05",
      "continueOnFail": true
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09PH87TE0P",
          "mode": "id"
        },
        "text": "=Source Code:\n\n{{ $('Business Analyst: Task Completion Result Send').item.json.sourceCode }}",
        "otherOptions": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        864,
        48
      ],
      "id": "43dbaac0-3a14-4206-8c29-83be5451afea",
      "name": "Send a message",
      "webhookId": "45abbc3d-4518-4137-85c3-d493c9950ca5",
      "credentials": {
        "slackApi": {
          "id": "3g4OIyDfKfAPDVBK",
          "name": "Slack account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "slack-webhook",
        "options": {}
      },
      "name": "Webhook: Slack Raw Technical Task Receiving",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1200,
        304
      ],
      "id": "6e067979-d958-4350-83fd-f192ecd3a1be",
      "webhookId": "c077c48b-8437-4275-b5d6-a79b771e84eb",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "http://host.docker.internal:5003/test-source-code",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={{ { taskId: $json.taskId } }}"
      },
      "name": "Tester: Test Source Code",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        112,
        112
      ],
      "id": "0c256b62-854f-4648-a945-d3d7ae786391",
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    json: $json,\n    binary: {\n      attachment: $('Webhook: Slack Raw Technical Task Receiving').item.binary.attachment\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1024,
        80
      ],
      "id": "dbb534cb-4cd2-4640-8f1c-f27c06aeefe6",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://host.docker.internal:5000/receive-message",
        "options": {
          "bodyContentType": "multipart-form-data"
        },
        "bodyParametersUi": {
          "parameter": [
            {
              "name": "message",
              "value": "={{ $json.body.message }}"
            },
            {
              "name": "attachment",
              "value": "={{  $binary.attachment0  }}"
            }
          ]
        }
      },
      "name": "Business Analyst: Raw Technical Task Send - To Delete",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 2,
      "position": [
        -592,
        112
      ],
      "id": "e659babb-729f-4bf4-89eb-4491ce84db34",
      "disabled": true,
      "continueOnFail": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:5000/receive-message",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "attachment",
              "inputDataFieldName": "attachment"
            },
            {
              "name": "message",
              "value": "={{ $('Webhook: Slack Raw Technical Task Receiving').item.json.body.message }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -848,
        96
      ],
      "id": "52f5aa8a-9de4-492d-9601-b2b5d0cd009c",
      "name": "Business Analyst: Raw Technical Task Send"
    },
    {
      "parameters": {
        "jsCode": "const raw = $json; // вся строка ответа\n\nconst body = raw.data; // строка multipart\nconst boundary = body.match(/--(.+?)\\r\\n/)[1];\n\n// Разбиваем части\nconst parts = body.split(`--${boundary}`).filter(p => p.trim());\n\n// Объекты для результата\nlet jsonPart = null;\nlet filePart = null;\nlet fileName = null;\nlet mime = null;\nlet fileData = null;\n\nfor (const part of parts) {\n  if (part.includes('application/json')) {\n    // JSON part\n    const jsonText = part.split('\\r\\n\\r\\n')[1].trim();\n    jsonPart = JSON.parse(jsonText);\n  }\n\n  if (part.includes('filename=')) {\n    // File part\n    const header = part.split('\\r\\n\\r\\n')[0];\n    fileData = part.split('\\r\\n\\r\\n')[1].trim();\n\n    // extract metadata\n    fileName = header.match(/filename=\"(.+?)\"/)[1];\n    mime = header.match(/Content-Type: (.+?)\\r\\n/)[1];\n\n    // convert to base64\n    filePart = Buffer.from(fileData, \"binary\").toString(\"base64\");\n  }\n}\n\nreturn [\n  {\n    json: {\n      parsedJson: jsonPart,\n      fileName,\n      mime,\n    },\n    binary: {\n      completion_result: {\n        data: filePart,\n        fileName,\n        mimeType: mime,\n      }\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        704,
        -224
      ],
      "id": "37cb91bc-b887-4d36-bf4b-a73c9e81e239",
      "name": "Parse Multipart Response",
      "disabled": true
    },
    {
      "parameters": {
        "resource": "file",
        "binaryPropertyName": "={{ $json.binary.file }}",
        "options": {
          "channelId": "C09PH87TE0P"
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        1200,
        -208
      ],
      "id": "4c2ec9d7-a2a7-467c-acf9-2da4345f03d5",
      "name": "Upload a file",
      "webhookId": "9179dd21-a0f8-4a25-8258-994c97e0643a",
      "credentials": {
        "slackApi": {
          "id": "3g4OIyDfKfAPDVBK",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Function Node\nconst imageBase64 =  $('Business Analyst: Task Completion Result Send').first().json.image.data// base64\nreturn {\n  binary: {\n    file: {\n      data: imageBase64,\n      mimeType: \"image/png\",\n      fileName: \"image.png\"\n    }\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1056,
        48
      ],
      "id": "46b657dd-c913-40b8-be9b-8271a4441908",
      "name": "Code in JavaScript1"
    }
  ],
  "pinData": {},
  "connections": {
    "Programmer: Technical Task Send": {
      "main": [
        [
          {
            "node": "Code Runner: Source Code Send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code Runner: Source Code Send": {
      "main": [
        [
          {
            "node": "Tester: Test Source Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Programmer: Code Runner Result Send": {
      "main": [
        [
          {
            "node": "Business Analyst: Task Completion Result Send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Business Analyst: Task Completion Result Send": {
      "main": [
        [
          {
            "node": "Parse Multipart Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook: Slack Raw Technical Task Receiving": {
      "main": [
        [
          {
            "node": "Respond to Slack Verification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tester: Test Source Code": {
      "main": [
        [
          {
            "node": "Programmer: Code Runner Result Send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Business Analyst: Raw Technical Task Send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Business Analyst: Raw Technical Task Send - To Delete": {
      "main": [
        [
          {
            "node": "Programmer: Technical Task Send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Business Analyst: Raw Technical Task Send": {
      "main": [
        [
          {
            "node": "Business Analyst: Raw Technical Task Send - To Delete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Slack Verification": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Multipart Response": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload a file": {
      "main": [
        []
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Upload a file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "755df5ae-8c05-40c7-b6e6-e23896abf4bf",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "eb4e11312a6611954811887d5478d8a22c8d0c00be3623bed1a2b98c1e3d5e2b"
  },
  "id": "N97dH9dZrXnHnF3a",
  "tags": []
}